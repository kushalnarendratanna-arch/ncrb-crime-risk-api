<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Child Safety Risk Assessment</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/static/style.css">
</head>

<body>

<div class="card">
<h3>Child Safety Risk Assessment</h3>

<select id="state">
  <option value="">Loading states...</option>
</select>

<select id="district">
  <option value="">Select state first</option>
</select>

<button onclick="checkRisk()">Check Risk</button>

<div id="result"></div>

<hr>

<div class="disclaimer">
<b>Legal & Educational Disclaimer:</b><br><br>

• IPC references are historical. IPC has been replaced by
<b>Bharatiya Nyaya Sanhita (BNS)</b> effective <b>1 July 2024</b>.<br><br>

• This application is for <b>educational & academic use only</b>.<br><br>

<b>Dataset last updated:</b> 12 July 2024<br><br>

<b>Developer:</b> Kushal Narendra Tanna<br>
<b>Email:</b> kushalnarendratanna@gmail.com<br><br>

© 2025 All Rights Reserved
</div>
</div>

<script>
fetch("/states")
.then(r => r.json())
.then(states => {
  const s = document.getElementById("state");
  s.innerHTML = "<option value=''>Select State</option>";
  states.forEach(x => {
    s.innerHTML += `<option value="${x}">${x}</option>`;
  });
});

document.getElementById("state").addEventListener("change", function () {
  fetch(`/districts?state=${encodeURIComponent(this.value)}`)
    .then(r => r.json())
    .then(d => {
      const dist = document.getElementById("district");
      dist.innerHTML = "<option value=''>Select District</option>";
      d.forEach(x => dist.innerHTML += `<option value="${x}">${x}</option>`);
    });
});

function checkRisk() {
  const result = document.getElementById("result");

  fetch("/predict", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      state: document.getElementById("state").value,
      district: document.getElementById("district").value
    })
  })
  .then(r => r.json())
  .then(j => {
    if (j.error) {
      result.innerHTML = "❌ " + j.error;
      return;
    }
    result.innerHTML = `
      <b>Risk Level:</b> <span style="color:${j.color}">${j.risk_level}</span><br>
      <b>Risk Score:</b> ${j.risk_score}/100<br>
      <b>Confidence:</b> ${j.confidence}%
    `;
  })
  .catch(() => result.innerHTML = "❌ Server error. Please retry.");
}
</script>

</body>
</html>