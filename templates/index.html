<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Child Safety Risk</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color: white;
}

.card {
  max-width: 420px;
  margin: 40px auto;
  background: #1e2f38;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}

select, input, button {
  width: 100%;
  padding: 11px;
  margin-top: 10px;
  border-radius: 6px;
  border: none;
}

button {
  background: #ff9800;
  font-weight: bold;
}

#result {
  margin-top: 15px;
  background: #16242c;
  padding: 10px;
  border-radius: 8px;
}

.disclaimer {
  margin-top: 20px;
  font-size: 13px;
  color: #ddd;
}
</style>
</head>

<body>

<div class="card">
  <h3>Child Safety Risk Assessment</h3>

  <select id="state"></select>
  <input id="search" placeholder="Search district">
  <select id="district"></select>

  <button onclick="checkRisk()">Check Risk</button>

  <div id="result"></div>

  <div class="disclaimer">
    <b>Legal & Educational Disclaimer:</b><br>
    • IPC references are used for historical dataset consistency. IPC has been officially
    replaced by <b>Bharatiya Nyaya Sanhita (BNS)</b> effective from <b>1st July 2024</b>.<br><br>

    • This application is developed strictly for <b>educational and academic purposes only</b>.
    It must <b>not</b> be used for legal, law-enforcement, or decision-making purposes.<br><br>

    <b>Developer:</b> Kushal Narendra Tanna<br>
    <b>Email:</b> kushalnarendratanna@gmail.com<br><br>

    © 2024–2025 Kushal Narendra Tanna. All rights reserved.
  </div>
</div>

<script>
let allDistricts = [];

fetch("/states")
.then(r => r.json())
.then(states => {
  let s = document.getElementById("state");
  s.innerHTML = "<option value=''>Select State</option>";
  states.forEach(x => s.innerHTML += `<option value="${x}">${x}</option>`);
});

document.getElementById("state").onchange = function () {
  fetch(`/districts?state=${encodeURIComponent(this.value)}`)
    .then(r => r.json())
    .then(d => {
      allDistricts = d;
      renderDistricts(d);
    });
};

document.getElementById("search").oninput = function () {
  let q = this.value.toLowerCase();
  renderDistricts(allDistricts.filter(x => x.toLowerCase().includes(q)));
};

function renderDistricts(list) {
  let d = document.getElementById("district");
  d.innerHTML = "<option value=''>Select District</option>";
  list.forEach(x => d.innerHTML += `<option value="${x}">${x}</option>`);
}

function checkRisk() {
  let state = document.getElementById("state").value;
  let district = document.getElementById("district").value;
  let result = document.getElementById("result");

  if (!state || !district) {
    result.innerHTML = "⚠️ Please select state and district.";
    return;
  }

  result.innerHTML = "⏳ Calculating risk...";

  fetch("/predict", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({state, district})
  })
  .then(res => res.json())
  .then(j => {
    if (j.error) {
      result.innerHTML = "❌ " + j.error;
      return;
    }

    result.innerHTML = `
      <b>State:</b> ${j.state}<br>
      <b>District:</b> ${j.district}<br><br>
      <b>Total Crimes:</b> ${j.total}<br>
      <b>Risk Level:</b>
      <span style="color:${j.color};font-weight:bold">${j.risk_level}</span><br>
      <b>Risk Score:</b> ${j.risk_score}/100<br>
      <b>Confidence:</b> ${j.confidence}%
    `;
  })
  .catch(() => result.innerHTML = "❌ Server error");
}
</script>

</body>
</html>
