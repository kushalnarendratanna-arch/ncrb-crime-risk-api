<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Child Safety Risk Assessment</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/static/style.css">
</head>

<body>

<div class="card">
  <h3>Child Safety Risk Assessment</h3>

  <select id="state"></select>
  <input id="search" placeholder="Search district">
  <select id="district"></select>

  <button onclick="checkRisk()">Check Risk</button>

  <div id="result"></div>

  <hr>

  <div class="disclaimer">
    <b>Legal & Educational Disclaimer:</b><br><br>

    • Indian Penal Code (IPC) references are used for historical and dataset consistency.
    IPC has been officially replaced by <b>Bharatiya Nyaya Sanhita (BNS)</b>,
    effective from <b>1st July 2024</b>.<br><br>

    • This application is developed strictly for
    <b>educational and academic purposes only</b>.
    It must <b>not</b> be used for legal, law-enforcement,
    or decision-making purposes.<br><br>

    <b>Dataset last updated:</b> 12 July 2024<br><br>

    <b>Developer:</b> Kushal Narendra Tanna<br>
    <b>Email:</b> kushalnarendratanna@gmail.com<br><br>

    © 2025 All Rights Reserved
  </div>
</div>

<script>
let allDistricts = [];

fetch("/states")
.then(r => r.json())
.then(states => {
  let s = document.getElementById("state");
  s.innerHTML = "<option value=''>Select State</option>";
  states.forEach(x => s.innerHTML += `<option>${x}</option>`);
});

document.getElementById("state").onchange = function () {
  fetch(`/districts?state=${encodeURIComponent(this.value)}`)
    .then(r => r.json())
    .then(d => {
      allDistricts = d;
      renderDistricts(d);
    });
};

document.getElementById("search").oninput = function () {
  let q = this.value.toLowerCase();
  renderDistricts(allDistricts.filter(x => x.toLowerCase().includes(q)));
};

function renderDistricts(list) {
  let d = document.getElementById("district");
  d.innerHTML = "<option value=''>Select District</option>";
  list.forEach(x => d.innerHTML += `<option>${x}</option>`);
}

function checkRisk() {
  let result = document.getElementById("result");

  fetch("/predict", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      state: document.getElementById("state").value,
      district: document.getElementById("district").value
    })
  })
  .then(r => r.json())
  .then(j => {
    if (j.error) {
      result.innerHTML = "❌ " + j.error;
      return;
    }

    result.innerHTML = `
      <b>Risk Level:</b>
      <span style="color:${j.color};font-weight:bold">${j.risk_level}</span><br>
      <b>Risk Score:</b> ${j.risk_score}/100<br>
      <b>Confidence:</b> ${j.confidence}%
    `;
  })
  .catch(() => {
    result.innerHTML = "❌ Server error. Please retry.";
  });
}
</script>

</body>
</html>
